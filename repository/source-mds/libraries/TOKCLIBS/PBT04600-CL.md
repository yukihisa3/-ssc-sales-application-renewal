# PBT04600

**種別**: JCL  
**ライブラリ**: TOKCLIBS  
**ソースファイル**: `source/navs/cobol/programs/TOKCLIBS/PBT04600.CL`

## ソースコード

```jcl
/. ***********************************************************  ./
/. *   サカタのタネ殿　本社システム　　　  　　　　　        *  ./
/. *   SYSTEM-NAME :   ＨＧ基幹システム　　　　　　　　　    *  ./
/. *   JOB-ID      :   PBT04600                              *  ./
/. *   JOB-NAME    :   出荷梱包送信データセット　　　　　　  *  ./
/. *                    （カインズ）　　　　　　　　　　　　 *  ./
/. *                    ※栃木倉庫　　　　　　　　　　　　　 *  ./
/. *   UPDATE      :                                         *  ./
/. ***********************************************************  ./
    PGM
/.###ﾜｰｸｴﾘｱ定義####./
    VAR ?WS      ,STRING*08,VALUE-'        '      /.ﾜｰｸｽﾃｰｼｮﾝ文字  ./
    VAR ?BUMON   ,STRING*04,VALUE-'    '          /.部門名       ./
    VAR ?TANCD6  ,STRING*06,VALUE-'      '        /.担当者CDWK   ./
    VAR ?TANCD   ,STRING*02,VALUE-'  '            /.担当者CD     ./
    VAR ?SOUKO   ,STRING*02,VALUE-'  '            /.倉庫コード     ./
    VAR ?DSOUKO  ,STRING*02,VALUE-'  '            /.代表倉庫コード ./
    VAR ?WKSTN   ,NAME                            /.ﾜｰｸｽﾃｰｼｮﾝ名前  ./
    VAR ?PGMEC   ,INTEGER                         /.ﾌﾟﾛｸﾞﾗﾑｴﾗｰｺｰﾄﾞ ./
    VAR ?PGMECX  ,STRING*11                       /.ｼｽﾃﾑｴﾗｰｺｰﾄﾞ    ./
    VAR ?PGMEM   ,STRING*99                       /.ｼｽﾃﾑｴﾗｰﾒｯｾｰｼﾞ  ./
    VAR ?MSG     ,STRING*99(6)                    /.ﾒｯｾｰｼﾞ格納ﾃｰﾌﾞﾙ./
    VAR ?MSGX    ,STRING*99                         /.SNDMSG表示用 ./
    VAR ?CLID    ,STRING*08,VALUE-'PBT04600'        /.CLID         ./
    VAR ?STEP    ,STRING*08                         /.STEP-ID      ./
    VAR ?CLNM    ,STRING*40                         /.CL名称       ./
    VAR ?KEKA1   ,STRING*40                         /.ﾒｯｾｰｼﾞ1      ./
    VAR ?KEKA2   ,STRING*40                         /.ﾒｯｾｰｼﾞ2      ./
    VAR ?KEKA3   ,STRING*40                         /.ﾒｯｾｰｼﾞ3      ./
    VAR ?KEKA4   ,STRING*40                         /.ﾒｯｾｰｼﾞ4      ./
    VAR ?OPR1    ,STRING*50                         /.ﾒｯｾｰｼﾞ1    ./
    VAR ?OPR2    ,STRING*50                         /.      2    ./
    VAR ?OPR3    ,STRING*50                         /.      3    ./
    VAR ?OPR4    ,STRING*50                         /.      4    ./
    VAR ?OPR5    ,STRING*50                         /.      5    ./
    VAR ?ERRCD   ,STRING*1                          /.ｴﾗｰCD      ./
    VAR ?KEKKA   ,STRING*1,VALUE-'0'                /.送信結果   ./

   /.##パラメタ（個別）##./
    /.抽出件数情報./
    VAR ?SYURUIA ,STRING*01,VALUE-' '         /.抽出種　出A(ONL)./
    VAR ?KENSUUA ,STRING*08,VALUE-'00000000'  /.　件数　出A(ONL)./
    VAR ?SYURUIB ,STRING*01,VALUE-' '         /.抽出種　出B(ｼﾞｭﾝ)./
    VAR ?KENSUUB ,STRING*08,VALUE-'00000000'  /.　件数　出B(ｼﾞｭﾝ)./
    VAR ?SYURUIC ,STRING*01,VALUE-' '         /.抽出種　出C(手書)./
    VAR ?KENSUUC ,STRING*08,VALUE-'00000000'  /.　件数　出C(手書)./
    VAR ?SYURUID ,STRING*01,VALUE-' '         /.抽出種　出D(入出)./
    VAR ?KENSUUD ,STRING*08,VALUE-'00000000'  /.　件数　出D(入出)./
    VAR ?SYURUIE ,STRING*01,VALUE-' '         /.抽出種　出E(作業)./
    VAR ?KENSUUE ,STRING*08,VALUE-'00000000'  /.　件数　出E(作業)./
    VAR ?SYURUIF ,STRING*01,VALUE-' '         /.抽出種　出F(振替)./
    VAR ?KENSUUF ,STRING*08,VALUE-'00000000'  /.　件数　出F(振替)./
    VAR ?SYURUIG ,STRING*01,VALUE-' '         /.抽出種　入G(入荷)./
    VAR ?KENSUUG ,STRING*08,VALUE-'00000000'  /.　件数　入G(入荷)./
    VAR ?SYURUIH ,STRING*01,VALUE-' '         /.抽出種　入H(入出)./
    VAR ?KENSUUH ,STRING*08,VALUE-'00000000'  /.　件数　入H(入出)./
    VAR ?SYURUII ,STRING*01,VALUE-' '         /.抽出種　入I(作業)./
    VAR ?KENSUUI ,STRING*08,VALUE-'00000000'  /.　件数　入I(作業)./
    VAR ?SYURUIJ ,STRING*01,VALUE-' '         /.抽出種　入J(振替)./
    VAR ?KENSUUJ ,STRING*08,VALUE-'00000000'  /.　件数　入J(振替)./
    VAR ?SYURUIK ,STRING*01,VALUE-' '         /.抽出種　出K(カＯ)./
    VAR ?KENSUUK ,STRING*08,VALUE-'00000000'  /.　件数　出K(カＯ)./
    VAR ?SYURUIL ,STRING*01,VALUE-' '         /.抽出種　出L(カ手)./
    VAR ?KENSUUL ,STRING*08,VALUE-'00000000'  /.　件数　出L(カ手)./
    VAR ?SYURUIZ ,STRING*01,VALUE-' '         /.抽出種　DUMMY./
    VAR ?KENSUUZ ,STRING*08,VALUE-'00000000'  /.　件数　DUMMY./

    VAR ?CYOUHYOU,STRING*01,VALUE-'S'         /.帳票区分　　　　 ./

   /.##パラメタ（出荷）##./
    VAR ?PA01    ,STRING*04,VALUE-'0000'       /.部門ＣＤ ./
    VAR ?PA02    ,STRING*02,VALUE-'00'         /.担当者ＣＤ ./
    VAR ?PA03    ,STRING*01,VALUE-' '          /.送信区分 ./
    VAR ?PA04    ,STRING*01,VALUE-' '          /.抽出区分-ONL ./
    VAR ?PA05    ,STRING*01,VALUE-' '          /.抽出区分-手書./
    VAR ?PA06    ,STRING*01,VALUE-' '          /.抽出区分-横持./
    VAR ?PA07    ,STRING*02,VALUE-'  '         /.抽出倉庫ＣＤ ./
    VAR ?PA08    ,STRING*08,VALUE-'00000000'   /.バ-受信日-ONL./
    VAR ?PA09    ,STRING*04,VALUE-'0000'       /.バ-受信時-ONL./
    VAR ?PA10    ,STRING*08,VALUE-'00000000'   /.バ-取引先-ONL./
    VAR ?PA11    ,STRING*08,VALUE-'00000000'   /.納品日-FROM-ONL./
    VAR ?PA12    ,STRING*08,VALUE-'00000000'   /.納品日-TO-ONL./
    VAR ?PA13    ,STRING*05,VALUE-'00000'      /.店舗-FROM-ONL./
    VAR ?PA14    ,STRING*05,VALUE-'00000'      /.店舗-TO-ONL./
    VAR ?PA15    ,STRING*08,VALUE-'00000000'   /.取引先-手書./
    VAR ?PA16    ,STRING*09,VALUE-'000000000'  /.伝票-FROM-手書./
    VAR ?PA17    ,STRING*09,VALUE-'000000000'  /.伝票-TO-手書./
    VAR ?PA18    ,STRING*08,VALUE-'00000000'   /.納品日-FROM-手書./
    VAR ?PA19    ,STRING*08,VALUE-'00000000'   /.納品日-TO-手書./
    VAR ?PA20    ,STRING*08,VALUE-'00000000'   /.横持日-横持ち./

   /.##パラメタ（入荷）##./
    VAR ?PB01    ,STRING*04,VALUE-'0000'       /.部門ＣＤ ./
    VAR ?PB02    ,STRING*02,VALUE-'00'         /.担当者ＣＤ ./
    VAR ?PB03    ,STRING*01,VALUE-' '          /.送信区分 ./
    VAR ?PB04    ,STRING*01,VALUE-' '          /.抽出区分-入荷./
    VAR ?PB05    ,STRING*01,VALUE-' '          /.抽出区分-横持./
    VAR ?PB06    ,STRING*02,VALUE-'  '         /.抽出倉庫ＣＤ ./
    VAR ?PB07    ,STRING*08,VALUE-'00000000'   /.連携日　　　 ./

   /.##パラメタ（エラー判定用）##./
    VAR ?ERR     ,STRING*01,VALUE-' '

   /.##倉庫別ファイルＩＤ編集用##./
    VAR ?FILLNK   ,STRING*6,VALUE-'CNZLNK'     /.梱包データ./
    VAR ?FILLNB   ,STRING*3,VALUE-'CNZ'        /.バックアップ./
    VAR ?FILNM    ,STRING*8,VALUE-'        '
    VAR ?LINKSLIB ,STRING*8,VALUE-'LINKSLIB'
    VAR ?LIBNM    ,STRING*8,VALUE-'TOKKLIB '
    VAR ?FILID    ,NAME
    VAR ?LIBID    ,NAME
    VAR ?CNZLNKF  ,NAME!MOD
    VAR ?CNZLNKX  ,STRING*17
    VAR ?BKUPF01  ,NAME!MOD
    VAR ?BKUPF02  ,NAME!MOD
    VAR ?BKUPF03  ,NAME!MOD
    VAR ?BKUPF04  ,NAME!MOD
    VAR ?BKUPF05  ,NAME!MOD
    VAR ?BKUPF06  ,NAME!MOD
    VAR ?BKUPF07  ,NAME!MOD
    VAR ?BKUPF08  ,NAME!MOD
    VAR ?BKUPF09  ,NAME!MOD
    VAR ?BKUPF10  ,NAME!MOD
    VAR ?BKUPFX   ,STRING*17

    VAR ?FILCNZW  ,STRING*6,VALUE-'CNZSYW'     /.カインズワーク./
    VAR ?FILNMW   ,STRING*8,VALUE-'        '
    VAR ?LIBNMW   ,STRING*8,VALUE-'BMSFLIB '
    VAR ?FILIDW   ,NAME
    VAR ?LIBIDW   ,NAME
    VAR ?CNZSYWF  ,NAME!MOD
    VAR ?CNZSYWX  ,STRING*17

/.==================================================================./

/.##実行PG名称ｾｯﾄ##./
    ?CLNM := '出荷梱包送信データセット（カインズ）'
/.##ﾗｲﾌﾞﾗﾘﾘｽﾄ登録##./
    DEFLIBL TOKELIB/TOKELIBO/TOKFLIB/TOKKLIB/BMSFLIB/ONLBLIB/LINKSLIB
/.##ﾌﾟﾛｸﾞﾗﾑ開始ﾒｯｾｰｼﾞ##./
    ?MSGX :=  '***   '  && ?CLID  &&   ' START  ***'
    SNDMSG    ?MSGX,TO-XCTL
/.## ﾜｰｸｽﾃｰｼｮﾝ名取得##./
    ?WKSTN   :=  @ORGWS
    ?WS      :=  %STRING(?WKSTN)
    ?MSGX    :=  '## ﾜｰｸｽﾃｰｼｮﾝ名 = ' && ?WS
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

/.==================================================================./

/.##実行確認##./
    ?OPR1  :=  ''
    ?OPR2  :=  '　出荷梱包データを、送信用ファイルにセットします'
    ?OPR3  :=  '　　　　　　　　【カインズ向け】'
    ?OPR4  :=  ''
    ?OPR5  :=  '　　　　　チェックは完了していますか？'
    CALL      OHOM0900.TOKELIB,PARA-
                            (?OPR1,?OPR2,?OPR3,?OPR4,?OPR5)

/.==================================================================./

/.##ログインユーザー情報取得##./
SIT9000B:

    ?STEP :=   'SIT9000B'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    OVRF      FILE-LOGINUSR,TOFILE-LOGINUSR.@TEMP
    CALL      PGM-SIT9000B.TOKELIBO,PARA-(?BUMON,?TANCD6)
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  'ログイン情報取得'
              GOTO ABEND
    END
    ?TANCD := %SBSTR(?TANCD6,1,2)

/.==================================================================./

/.##倉庫コード取得##./
SKY1601B:

    ?STEP :=   'SKY1601B'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    OVRF      FILE-JYOKEN1,TOFILE-JYOKEN1.TOKFLIB
    CALL      PGM-SKY1601B.TOKELIB,
                  PARA-(?WS,?SOUKO,?DSOUKO)
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '倉庫コード取得'
              GOTO ABEND
    END
  /.SNDMSG    'WS=',TO-XCTL
    SNDMSG    ?WS,TO-XCTL
    SNDMSG    'SOUKO=',TO-XCTL
    SNDMSG    ?SOUKO,TO-XCTL
    SNDMSG    'DSOUKO=',TO-XCTL
    SNDMSG    ?DSOUKO,TO-XCTL   ./

/.==================================================================./

/.##出荷梱包送信結果チェック##./

    ?STEP :=   'SBT0460B'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    OVRF      FILE-PCCHKC,TOFILE-PCCHKC.ONLBLIB
    CALL      PGM-SBT0460B.TOKELIBO,
              PARA-(?KEKKA)
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信結果チェック'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    IF        ?KEKKA     =   '1'  THEN
              GOTO   ASSIGN1
    ELSE
              SNDMSG '！！！！！！！！！！！！！！！！',
                                                 TOWS-@ORGWS
              SNDMSG '！　未送信の出荷梱包データが　！',
                                                 TOWS-@ORGWS
              SNDMSG '！　残っています。　　　　　　！',
                                                 TOWS-@ORGWS
              SNDMSG '！　確認してください。　　　　！',
                                                 TOWS-@ORGWS
              SNDMSG '！！！！！！！！！！！！！！！！',
                                                 TOWS-@ORGWS
              ?KEKA4 :=  '出荷梱包送信結果チェック'
              GOTO   ABEND
    END

/.==================================================================./

/.##ファイルロック##./
ASSIGN1:

    ?STEP :=   'ASSIGN1'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    ASSIGN    FILE-PCCHKC.ONLBLIB!@XCL
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              SNDMSG '！！！！！！！！！！！！！！！！',TOWS-@ORGWS
              SNDMSG '！他で連携処理が行われています！',TOWS-@ORGWS
              SNDMSG '！　（出荷梱包制御ファイル）　！',TOWS-@ORGWS
              SNDMSG '！！！！！！！！！！！！！！！！',TOWS-@ORGWS
              ?KEKA4 :=  '出荷梱包制御ファイルロック'
              GOTO ABEND
    END

    ASSIGN    FILE-SYKCNZF.ONLBLIB!@XCL
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              SNDMSG '！！！！！！！！！！！！！！！！',TOWS-@ORGWS
              SNDMSG '！他で連携処理が行われています！',TOWS-@ORGWS
              SNDMSG '！　（出荷梱包送信ファイル）　！',TOWS-@ORGWS
              SNDMSG '！！！！！！！！！！！！！！！！',TOWS-@ORGWS
              ?KEKA4 :=  '出荷梱包ＭＳＧファイルロック'
              GOTO ABEND
    END

/.==================================================================./

/.##倉庫コード指定##./
SKY1701I:

    ?STEP :=   'SKY1701I'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    OVRDSPF   FILE-DSPF,TOFILE-DSPF.TOKELIB,MEDLIB-TOKELIB
    OVRF      FILE-ZSOKMS1,TOFILE-ZSOKMS1.TOKFLIB
    CALL      PGM-SKY1701I.TOKELIB,
              PARA-(?SOUKO)
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0   THEN
         IF   ?PGMEC     =   4010 THEN
              SNDMSG MSG-'##取消終了##',TO-XCTL.@ORGPROF,JLOG-@YES
              ?MSGX :=  '***   '  && ?CLID  &&   ' END    ***'
              SNDMSG    ?MSGX,TO-XCTL
              RETURN
         ELSE
              ?KEKA4 :=  '倉庫コード指定'
              GOTO ABEND
         END
    END
    ?MSGX := '# 倉庫ＣＤ = ' && ?SOUKO && ' #'
    SNDMSG    ?MSGX,TO-XCTL

/.==================================================================./

/.##ASSIGNファイルID取得##./
EDTFILE1:

    ?STEP :=   'EDTFILE1'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    /.出荷梱包データ(セット元)./
    ?FILNM    :=    ?FILLNK && ?SOUKO
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?CNZLNKF  :=    %NCAT(?FILID,?LIBID)
    ?CNZLNKX  :=    %STRING(?CNZLNKF)
    ?MSGX :=  '## 出荷梱包データ(セット元)= '
               &&  ?CNZLNKX  &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

/.##出荷梱包データ(セット元)ロック##./
ASSIGN2:

    ?STEP :=   'ASSIGN2'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    ASSIGN    FILE-?CNZLNKF!@XCL
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              SNDMSG '！！！！！！！！！！！！！！！！',TOWS-@ORGWS
              SNDMSG '！他で連携処理が行われています！',TOWS-@ORGWS
              SNDMSG '！！！！！！！！！！！！！！！！',TOWS-@ORGWS
              ?KEKA4 :=  '出荷梱包データ(セット元)ロック'
              GOTO ABEND
    END

/.==================================================================./

/.##出荷梱包データ有無チェック##./
SBT0400B:

    ?STEP :=   'SBT0400B'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    OVRF      FILE-CNZLNKF,TOFILE-?CNZLNKF
    CALL      PGM-SBT0400B.TOKELIBO,
              PARA-(?KEKKA)
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包データ有無チェック'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    IF        ?KEKKA     =   '0'  THEN
              GOTO   CNVFILE1
    ELSE
              SNDMSG '！！！！！！！！！！！！！！！！！',
                                                      TOWS-@ORGWS
              SNDMSG '！出荷梱包データ＝０件　　　　　！',
                                                      TOWS-@ORGWS
              SNDMSG '！セットすべきデータがありません！',
                                                      TOWS-@ORGWS
              SNDMSG '！取込が行われていない可能性あり！',
                                                      TOWS-@ORGWS
              SNDMSG '！！！！！！！！！！！！！！！！！',
                                                      TOWS-@ORGWS
              ?KEKA4 :=  '出荷梱包データ有無チェック'
              GOTO   ABEND
    END

/.==================================================================./

/.##出荷梱包送信データセット##./
CNVFILE1:

    ?STEP :=   'CNVFILE1'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    CNVFILE   FILE-?CNZLNKF,
              TOFILE-SYKCNZF.ONLBLIB,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データセット'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

/.==================================================================./

/.##バックアップファイルID取得##./
EDTFILE2:

    ?STEP :=   'EDTFILE2'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    /.出荷梱包バックアップデータ01./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '01'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF01  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF01)
    ?MSGX :=  '## 出荷梱包バックアップデータ01= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ02./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '02'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF02  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF02)
    ?MSGX :=  '## 出荷梱包バックアップデータ02= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ03./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '03'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF03  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF03)
    ?MSGX :=  '## 出荷梱包バックアップデータ03= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ04./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '04'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF04  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF04)
    ?MSGX :=  '## 出荷梱包バックアップデータ04= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ05./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '05'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF05  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF05)
    ?MSGX :=  '## 出荷梱包バックアップデータ05= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ06./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '06'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF06  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF06)
    ?MSGX :=  '## 出荷梱包バックアップデータ06= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ07./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '07'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF07  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF07)
    ?MSGX :=  '## 出荷梱包バックアップデータ07= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ08./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '08'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF08  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF08)
    ?MSGX :=  '## 出荷梱包バックアップデータ08= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ09./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '09'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF09  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF09)
    ?MSGX :=  '## 出荷梱包バックアップデータ09= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

    /.出荷梱包バックアップデータ10./
    ?FILNM    :=    ?FILLNB && ?SOUKO && '10'
    ?FILID    :=    %NAME(?FILNM)
    ?LIBID    :=    %NAME(?LINKSLIB)
    ?BKUPF10  :=    %NCAT(?FILID,?LIBID)
    ?BKUPFX   :=    %STRING(?BKUPF10)
    ?MSGX :=  '## 出荷梱包バックアップデータ10= '
               &&  ?BKUPFX   &&  ' ##'
    SNDMSG MSG-?MSGX,TO-XCTL.@ORGPROF,JLOG-@YES

/.==================================================================./

/.##出荷梱包送信データバックアップ##./
CNVFILE2:

    ?STEP :=   'CNVFILE2'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    CNVFILE   FILE-?BKUPF09,
              TOFILE-?BKUPF10,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ１０'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF08,
              TOFILE-?BKUPF09,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０９'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF07,
              TOFILE-?BKUPF08,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０８'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF06,
              TOFILE-?BKUPF07,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０７'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF05,
              TOFILE-?BKUPF06,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０６'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF04,
              TOFILE-?BKUPF05,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０５'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF03,
              TOFILE-?BKUPF04,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０４'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF02,
              TOFILE-?BKUPF03,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０３'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?BKUPF01,
              TOFILE-?BKUPF02,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０２'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

    CNVFILE   FILE-?CNZLNKF,
              TOFILE-?BKUPF01,
              ADD-@NO,
              BF-1
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包送信データバックアップ０１'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

/.==================================================================./

/.##出荷梱包制御ファイルクリア##./
CLRFILE1:

    ?STEP :=   'CLRFILE1'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    CLRFILE   FILE-PCCHKC.ONLBLIB
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包制御ファイルクリア'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

/.##出荷梱包データクリア##./
CLRFILE2:

    ?STEP :=   'CLRFILE2'
    ?MSGX :=  '***   '  && ?STEP   &&   '        ***'
    SNDMSG    ?MSGX,TO-XCTL

    CLRFILE   FILE-?CNZLNKF
    ?PGMEC    :=    @PGMEC
    ?PGMEM    :=    @PGMEM
    IF        ?PGMEC    ^=   0    THEN
              ?KEKA4 :=  '出荷梱包データクリア'
              ?ERR   :=  'E'
              GOTO   ABEND
    END

/.==================================================================./

/.##正常終了処理##./
RTN:

    RELEASE   PCCHKC.ONLBLIB!@XCL
    RELEASE   SYKCNZF.ONLBLIB!@XCL
    RELEASE   ?CNZLNKF!@XCL

    OVRDSPF   FILE-DSPF,TOFILE-DSPF.XUCL,MEDLIB-TOKELIB
    ?KEKA1 :=  '処理が正常終了しました。'
    ?KEKA2 :=  ''
    ?KEKA3 :=  '　【出荷梱包送信データセット】'
    ?KEKA4 :=  ''
    CALL SMG0030I.TOKELIB
                    ,PARA-('1',?CLNM,?KEKA1,?KEKA2,?KEKA3,?KEKA4)
    ?MSGX :=  '***   '  && ?CLID  &&   ' END    ***'
    SNDMSG    ?MSGX,TO-XCTL
    SNDMSG    '出荷梱包データの送信が可能になりました',TO-XCTL
    SNDMSG    '　　　　　（カインズ）　　　　　　　　',TO-XCTL

    RETURN    PGMEC-@PGMEC
/.==================================================================./

/.##異常終了処理##./
ABEND:

    RELEASE   PCCHKC.ONLBLIB!@XCL
    RELEASE   SYKCNZF.ONLBLIB!@XCL
    RELEASE   ?CNZLNKF!@XCL

    OVRDSPF   FILE-DSPF,TOFILE-DSPF.XUCL,MEDLIB-TOKELIB
    ?KEKA1 :=  '処理が異常終了しました。'
    ?KEKA2 :=  'ログリストを採取後、ＮＡＶへ連絡'
    ?KEKA3 :=  ''
    CALL SMG0030I.TOKELIB
                    ,PARA-('2',?CLNM,?KEKA1,?KEKA2,?KEKA3,?KEKA4)
    ?PGMECX   :=    %STRING(?PGMEC)
    ?MSG(1)   :=    '### ' && ?CLID && ' ABEND' && ' ###'
    ?MSG(2)   :=    '### ' && ' PGMEC = ' &&
                     %SBSTR(?PGMECX,8,4) && ' ###'
    ?MSG(3)   :=    '###' && ' LINE = '  && %LAST(LINE)      && ' ###'
    FOR ?I    :=     1 TO 3
        DO     ?MSGX :=   ?MSG(?I)
               SNDMSG    ?MSGX,TO-XCTL
    END

    RETURN    PGMEC-?PGMEC

```
